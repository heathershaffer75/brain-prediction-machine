<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üß† Prediction Machine ‚Äî Scenario Choices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111a2b;
      --panel2:#0f172a;
      --line:rgba(255,255,255,.12);
      --text:#e8eefc;
      --sub:#a9b7d6;
      --accent:#7cdbff;
      --good:#7CFFB2;
      --warn:#ffd27c;
      --bad:#ff7c9b;
      --shadow:0 16px 40px rgba(0,0,0,.35);
      --radius:18px;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 900px at 15% 10%, rgba(124,219,255,.16), transparent 60%),
                  radial-gradient(1000px 800px at 90% 25%, rgba(124,255,178,.10), transparent 55%),
                  linear-gradient(180deg, var(--bg), #070b14);
      color:var(--text);
    }
    header{
      padding:18px 16px 12px;
      border-bottom:1px solid var(--line);
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .subtitle{margin:6px 0 0;color:var(--sub);line-height:1.35;font-size:13px}
    main{max-width:1100px;margin:0 auto;padding:14px 16px 26px}
    .topRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-bottom:12px;
    }
    .pillRow{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .pill{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--sub);
    }
    .layout{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:12px;
    }
    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding:12px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .cardHeader h2{
      margin:0; font-size:15px; letter-spacing:.2px;
      display:flex; gap:10px; align-items:center;
    }
    .controls{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    select, button{
      font-family:inherit;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      color:var(--text);
      padding:9px 10px;
      font-size:13px;
    }
    button{
      cursor:pointer;
      border-color: rgba(124,219,255,.35);
      background:rgba(124,219,255,.12);
    }
    button.secondary{
      border-color: var(--line);
      background:rgba(255,255,255,.06);
      color:var(--sub);
    }
    button.danger{
      border-color: rgba(255,124,155,.35);
      background:rgba(255,124,155,.10);
    }
    .content{padding:14px}
    .scenarioTitle{
      font-size:16px;
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .scenarioText{
      margin:0;
      color:var(--sub);
      line-height:1.4;
      font-size:14px;
    }
    .choices{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 640px){
      .choices{grid-template-columns:1fr}
    }
    .choiceBtn{
      text-align:left;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.16);
      cursor:pointer;
      transition:.15s transform ease, .15s opacity ease, .15s border-color ease;
      min-height:60px;
      font-size:15px;
      line-height:1.25;
    }
    .choiceBtn:hover{transform:translateY(-1px); border-color:rgba(124,219,255,.35)}
    .choiceMeta{
      display:block;
      font-size:12px;
      color:var(--sub);
      margin-top:6px;
      font-family:var(--mono);
      opacity:.9;
    }
    .feedback{
      margin-top:12px;
      border-top:1px solid var(--line);
      padding-top:12px;
    }
    .banner{
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.14);
      margin-bottom:10px;
    }
    .banner.good{border-color:rgba(124,255,178,.35); background:rgba(124,255,178,.08)}
    .banner.warn{border-color:rgba(255,210,124,.35); background:rgba(255,210,124,.08)}
    .banner.bad{border-color:rgba(255,124,155,.35); background:rgba(255,124,155,.08)}
    .banner strong{display:block; margin-bottom:4px}
    .kv{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 700px){ .kv{grid-template-columns:1fr} }
    .kvBox{
      border:1px solid var(--line);
      background:rgba(0,0,0,.14);
      border-radius:16px;
      padding:10px 12px;
    }
    .kvBox .k{color:var(--sub); font-size:12px; margin-bottom:6px}
    .kvBox .v{font-size:13px; line-height:1.35}
    .rightCol .content{padding:12px 14px 14px}
    .small{font-size:12px;color:var(--sub);line-height:1.35}
    .toggleRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      border-top:1px solid var(--line);
      padding:10px 14px;
    }
    .toggle{
      display:flex; gap:8px; align-items:center; color:var(--sub); font-size:12px;
    }
    .toggle input{transform:translateY(1px)}
    .boardCols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 700px){ .boardCols{grid-template-columns:1fr} }
    .miniCol{
      border:1px solid var(--line);
      background:rgba(0,0,0,.14);
      border-radius:16px;
      overflow:hidden;
    }
    .miniColHeader{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; align-items:center;
    }
    .miniColHeader strong{font-size:13px}
    .miniColHeader span{font-size:11px;color:var(--sub);font-family:var(--mono)}
    ul{list-style:none;margin:0;padding:10px}
    li{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      border-radius:14px;
      padding:10px 10px;
      margin:8px 0;
      font-size:13px;
      line-height:1.25;
    }
    .tag{
      display:inline-block;
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--sub);
      margin-top:6px;
    }
    .tag.good{border-color:rgba(124,255,178,.35); color:rgba(124,255,178,.95)}
    .tag.warn{border-color:rgba(255,210,124,.35); color:rgba(255,210,124,.95)}
    .tag.bad{border-color:rgba(255,124,155,.35); color:rgba(255,124,155,.95)}
    textarea{
      width:100%;
      min-height:120px;
      background:rgba(0,0,0,.18);
      border:1px solid var(--line);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
      resize:vertical;
      font-family:var(--mono);
      font-size:12px;
      line-height:1.35;
    }
  </style>
</head>
<body>
<header>
  <h1>üß† Your Brain Is a Prediction Machine ‚Äî Scenario Choices</h1>
  <p class="subtitle">
    Detox-friendly: pick a scenario ‚Üí choose a response ‚Üí see why your brain wants it + what actually helps.
    Works great for SUD + Primary Mental Health.
  </p>
</header>

<main>
  <div class="topRow">
    <div class="pillRow">
      <span class="pill">EBPs: Psychoeducation</span>
      <span class="pill">CBT</span>
      <span class="pill">ACT</span>
      <span class="pill">Detox-friendly</span>
    </div>
    <div class="pillRow">
      <span class="pill">Big buttons</span>
      <span class="pill">Instant feedback</span>
      <span class="pill">Auto-builds board</span>
    </div>
  </div>

  <div class="layout">
    <!-- LEFT: SCENARIO + CHOICES -->
    <section class="card">
      <div class="cardHeader">
        <h2>üé¨ Scenario</h2>
        <div class="controls">
          <select id="scenarioSelect"></select>
          <button id="randomBtn">Random</button>
          <button class="secondary" id="resetChoiceBtn">Clear feedback</button>
        </div>
      </div>

      <div class="content">
        <h3 class="scenarioTitle" id="scenarioTitle">‚Äî</h3>
        <p class="scenarioText" id="scenarioText">‚Äî</p>

        <div class="choices" id="choices"></div>

        <div class="feedback" id="feedback" style="display:none;">
          <div class="banner" id="banner">
            <strong id="verdictTitle">‚Äî</strong>
            <div class="small" id="verdictLine">‚Äî</div>
          </div>

          <div class="kv">
            <div class="kvBox">
              <div class="k">üß† Why your brain predicts this will help</div>
              <div class="v" id="whyBrain">‚Äî</div>
            </div>
            <div class="kvBox">
              <div class="k">‚ö° Short-term effect</div>
              <div class="v" id="shortTerm">‚Äî</div>
            </div>
            <div class="kvBox">
              <div class="k">üßæ Long-term effect</div>
              <div class="v" id="longTerm">‚Äî</div>
            </div>
            <div class="kvBox">
              <div class="k">‚úÖ ‚ÄúActually helps‚Äù alternative</div>
              <div class="v" id="altHelp">‚Äî</div>
            </div>
          </div>

          <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="secondary" id="tryAnotherBtn">Try another choice</button>
            <button id="addToBoardBtn">Add to board</button>
          </div>

          <p class="small" style="margin-top:10px;">
            Facilitator prompt: ‚ÄúWhat is your brain trying to protect you from here?‚Äù and ‚ÄúWhat‚Äôs the cost later?‚Äù
          </p>
        </div>
      </div>
    </section>

    <!-- RIGHT: SCIENCE + BOARD -->
    <aside class="card rightCol">
      <div class="cardHeader">
        <h2>üß† Quick Brain Science</h2>
        <div class="controls">
          <button class="secondary" id="exportBtn">Export</button>
          <button class="danger" id="clearBoardBtn">Clear board</button>
        </div>
      </div>

      <div class="content">
        <div class="small">
          <b>Prediction = pull.</b> The brain guesses what will reduce discomfort fast.
          <br><b>Dopamine</b> often spikes for <i>anticipation</i>, not true satisfaction.
          <br><b>Fast relief trains loops</b> even when consequences show up later.
        </div>

        <div class="toggleRow">
          <label class="toggle"><input type="checkbox" id="showCategories" checked> Show category tags</label>
          <label class="toggle"><input type="checkbox" id="showBoard" checked> Show board</label>
        </div>

        <div id="boardArea">
          <div class="boardCols">
            <div class="miniCol">
              <div class="miniColHeader">
                <strong>üß† Brain predicts</strong>
                <span id="countPredict">0</span>
              </div>
              <ul id="predictList"></ul>
            </div>
            <div class="miniCol">
              <div class="miniColHeader">
                <strong>‚úÖ Actually helps</strong>
                <span id="countActual">0</span>
              </div>
              <ul id="actualList"></ul>
            </div>
          </div>
        </div>

        <div style="margin-top:10px;">
          <h3 style="margin:10px 0 6px; font-size:14px;">üì¶ Export Preview</h3>
          <textarea id="exportPreview" readonly placeholder="Click Export to generate text you can copy."></textarea>
        </div>
      </div>
    </aside>
  </div>
</main>

<script>
(function(){
  const $ = (id) => document.getElementById(id);
  const STORAGE_KEY = "prediction_machine_scenarios_v1";

  // ===== Scenario Bank =====
  // Detox-friendly: short, concrete, relatable, not too wordy.
  // Choices include "brain pull" options + "actually helps" options.
  const scenarios = [
    {
      id: "craving-1",
      title: "Craving spike after a stressful phone call",
      category: "Craving / Urge",
      text: "You hang up the phone and your body feels tight and restless. Your brain says, ‚ÄúI need relief NOW.‚Äù",
      choices: [
        {
          label: "‚ÄúJust one‚Äù (or planning the next use) to calm down",
          type: "trap",
          whyBrain: "Your brain predicts fast relief because it‚Äôs learned: discomfort ‚Üí substance ‚Üí temporary quiet.",
          shortTerm: "Numbs feelings quickly. Drops tension briefly.",
          longTerm: "Strengthens the craving loop and increases shame/withdrawal/anxiety later.",
          actuallyHelps: "Delay 10 minutes + urge surf + cold water + tell someone."
        },
        {
          label: "Isolate in bed and scroll to escape the feeling",
          type: "mixed",
          whyBrain: "Avoidance feels safe because it reduces stimulation and social pressure.",
          shortTerm: "Less input. Might feel calmer for a moment.",
          longTerm: "Avoidance can increase rumination and cravings; problems return bigger.",
          actuallyHelps: "Small movement + grounding + simple next step (shower, water, walk)."
        },
        {
          label: "Paced breathing + cold water + name the feeling out loud",
          type: "help",
          whyBrain: "This retrains the body alarm. You‚Äôre telling the nervous system: ‚ÄúWe‚Äôre safe enough.‚Äù",
          shortTerm: "Craving intensity often drops. Heart rate settles.",
          longTerm: "Builds confidence: ‚ÄúI can ride feelings without using.‚Äù",
          actuallyHelps: "Keep it short: 60‚Äì120 seconds is enough to start."
        },
        {
          label: "Ask staff/peer: ‚ÄúCan you sit with me for 2 minutes?‚Äù",
          type: "help",
          whyBrain: "Connection regulates the brain. Co-regulation reduces threat signals.",
          shortTerm: "You feel less alone and less reactive.",
          longTerm: "Builds recovery wiring: reach out instead of act out.",
          actuallyHelps: "Use a tiny ask: ‚Äú2 minutes.‚Äù Make it doable."
        }
      ]
    },
    {
      id: "anxiety-1",
      title: "Anxiety: Your brain predicts catastrophe",
      category: "Anxiety / Panic",
      text: "You feel anxiety rise and your mind starts saying: ‚ÄúThis is going to be a disaster.‚Äù",
      choices: [
        {
          label: "Google symptoms / replay worst-case scenarios",
          type: "trap",
          whyBrain: "Your brain thinks certainty = safety. It searches for answers to feel in control.",
          shortTerm: "Brief sense of control, then more fear.",
          longTerm: "Trains reassurance-seeking and keeps anxiety alive.",
          actuallyHelps: "Grounding + label thought as a thought + return to the present."
        },
        {
          label: "Avoid the thing completely",
          type: "trap",
          whyBrain: "Avoidance gives instant relief, so the brain learns it as the ‚Äúsolution.‚Äù",
          shortTerm: "Anxiety drops fast.",
          longTerm: "Avoidance grows anxiety over time and shrinks your world.",
          actuallyHelps: "Approach in tiny steps (ACT): ‚ÄòDo it anxious.‚Äô"
        },
        {
          label: "Name: ‚ÄúMy brain is predicting.‚Äù Then do one next step",
          type: "help",
          whyBrain: "You‚Äôre separating prediction from reality and choosing values-based action.",
          shortTerm: "Anxiety may still be there, but you feel more in control.",
          longTerm: "Builds tolerance and reduces fear learning.",
          actuallyHelps: "Use the script: ‚ÄòThanks brain. Noted.‚Äô"
        },
        {
          label: "Ask: ‚ÄúWhat would I do if I felt 10% safer?‚Äù",
          type: "help",
          whyBrain: "Small safety increases widen your options without requiring perfection.",
          shortTerm: "Creates momentum.",
          longTerm: "Builds skill: regulate first, then decide.",
          actuallyHelps: "Pick one small safety action (water, breathe, sit upright)."
        }
      ]
    },
    {
      id: "people-1",
      title: "People-pleasing: You feel tension with someone",
      category: "People-pleasing",
      text: "Someone seems annoyed. Your brain says: ‚ÄúFix it. Make them like you. Don‚Äôt cause problems.‚Äù",
      choices: [
        {
          label: "Over-explain and apologize repeatedly",
          type: "mixed",
          whyBrain: "Your brain predicts this will prevent rejection and restore connection quickly.",
          shortTerm: "Temporary relief if they reassure you.",
          longTerm: "Trains anxiety + loss of self-trust; can invite resentment.",
          actuallyHelps: "Use one clear sentence, then pause: ‚ÄòI hear you. I‚Äôll think on it.‚Äô"
        },
        {
          label: "Get resentful silently and withdraw",
          type: "trap",
          whyBrain: "Withdrawal avoids conflict and protects you from feeling exposed.",
          shortTerm: "Less discomfort in the moment.",
          longTerm: "Builds resentment and disconnection; can trigger cravings.",
          actuallyHelps: "Name the need and set a small boundary respectfully."
        },
        {
          label: "Check the story: ‚ÄòDo I know they‚Äôre mad, or am I predicting?‚Äô",
          type: "help",
          whyBrain: "You‚Äôre challenging mind-reading and interrupting the threat story.",
          shortTerm: "Less spiraling.",
          longTerm: "Builds reality-testing and calmer relationships.",
          actuallyHelps: "Ask one clarifying question, not a whole speech."
        },
        {
          label: "Use a boundary micro-script",
          type: "help",
          whyBrain: "Boundaries reduce threat because you‚Äôre no longer relying on mind-reading for safety.",
          shortTerm: "Nervous, but clearer.",
          longTerm: "Self-respect grows; relationships become more stable.",
          actuallyHelps: "Try: ‚ÄòI can‚Äôt do that, but I can do this‚Ä¶‚Äô"
        }
      ]
    },
    {
      id: "rumination-1",
      title: "Rumination: Your mind won‚Äôt stop replaying",
      category: "Rumination",
      text: "Your brain is replaying a moment on loop trying to ‚Äòsolve‚Äô it.",
      choices: [
        {
          label: "Replay it again to ‚Äòfigure it out‚Äô",
          type: "trap",
          whyBrain: "Your brain predicts thinking = control, and control = safety.",
          shortTerm: "Feels productive for a second.",
          longTerm: "Loop strengthens; sleep and mood worsen.",
          actuallyHelps: "Write the thought once, then redirect attention on purpose."
        },
        {
          label: "Judge yourself for thinking too much",
          type: "trap",
          whyBrain: "Criticism pretends to motivate change, but it‚Äôs usually threat-based.",
          shortTerm: "None (usually makes it worse).",
          longTerm: "More shame; more rumination; higher relapse risk.",
          actuallyHelps: "Try self-compassion + one grounding action."
        },
        {
          label: "Do a 60-second ‚Äòname 5 things‚Äô grounding",
          type: "help",
          whyBrain: "You move from mind loops to sensory present-time input.",
          shortTerm: "Loop volume drops.",
          longTerm: "Builds regulation skill you can repeat anytime.",
          actuallyHelps: "Pair with a short action (stand, stretch, water)."
        },
        {
          label: "Ask: ‚ÄòWhat‚Äôs the next right step?‚Äô then do it",
          type: "help",
          whyBrain: "Action signals safety to the brain more than analysis does.",
          shortTerm: "More agency.",
          longTerm: "Less avoidance; better mood and self-trust.",
          actuallyHelps: "Keep it tiny: ‚Äònext 2 minutes.‚Äô"
        }
      ]
    }
  ];

  // ===== State =====
  const state = {
    scenarioId: scenarios[0]?.id || null,
    selectedChoiceIndex: null,
    boardPredict: [],
    boardActual: [],
    showCategories: true,
    showBoard: true
  };

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const parsed = JSON.parse(raw);
      if(parsed && typeof parsed === "object") Object.assign(state, parsed);
    }catch(e){}
  }

  function findScenario(id){
    return scenarios.find(s => s.id === id) || scenarios[0];
  }

  function tagClass(type){
    if(type === "help") return "good";
    if(type === "mixed") return "warn";
    return "bad";
  }

  function verdictFor(type){
    if(type === "help") return {title:"‚úÖ Real Help Choice", cls:"good", line:"This supports regulation, approach, and long-term recovery wiring."};
    if(type === "mixed") return {title:"‚ö†Ô∏è Mixed Choice", cls:"warn", line:"Not ‚Äòbad,‚Äô but it can drift into avoidance or reassurance loops if it becomes the default."};
    return {title:"üö® Quick Relief Trap", cls:"bad", line:"Your brain predicts fast relief, but it usually strengthens the loop and increases cost later."};
  }

  function renderScenarioSelect(){
    const sel = $("scenarioSelect");
    sel.innerHTML = "";
    scenarios.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s.id;
      opt.textContent = `${s.category} ‚Äî ${s.title}`;
      sel.appendChild(opt);
    });
    sel.value = state.scenarioId || scenarios[0].id;
  }

  function renderScenario(){
    const s = findScenario(state.scenarioId);
    $("scenarioTitle").textContent = s.title;
    $("scenarioText").textContent = s.text;

    const choicesWrap = $("choices");
    choicesWrap.innerHTML = "";

    s.choices.forEach((c, idx) => {
      const btn = document.createElement("button");
      btn.className = "choiceBtn";
      btn.innerHTML = `${c.label}<span class="choiceMeta">Tap to see what happens next</span>`;
      btn.onclick = () => selectChoice(idx);
      choicesWrap.appendChild(btn);
    });

    renderFeedback();
    renderBoard();
    save();
  }

  function selectChoice(idx){
    state.selectedChoiceIndex = idx;
    renderFeedback();
    save();
  }

  function renderFeedback(){
    const s = findScenario(state.scenarioId);
    const fb = $("feedback");

    if(state.selectedChoiceIndex === null || state.selectedChoiceIndex === undefined){
      fb.style.display = "none";
      return;
    }

    const c = s.choices[state.selectedChoiceIndex];
    fb.style.display = "block";

    const v = verdictFor(c.type);
    $("banner").className = "banner " + v.cls;
    $("verdictTitle").textContent = v.title;
    $("verdictLine").textContent = v.line;

    $("whyBrain").textContent = c.whyBrain;
    $("shortTerm").textContent = c.shortTerm;
    $("longTerm").textContent = c.longTerm;
    $("altHelp").textContent = c.actuallyHelps;
  }

  function addToBoard(){
    const s = findScenario(state.scenarioId);
    if(state.selectedChoiceIndex === null) return;

    const c = s.choices[state.selectedChoiceIndex];

    // Auto-create clean, board-ready entries
    // Brain predicts: the "trap" or "brain pull" statement
    // Actually helps: the alternative skill statement
    const predictText = c.label;
    const actualText = c.actuallyHelps;

    // Keep them short and not duplicate-spammy
    const cat = s.category;

    state.boardPredict.unshift({ text: predictText, category: cat, type: c.type, ts: Date.now() });
    state.boardActual.unshift({ text: actualText, category: cat, type: "help", ts: Date.now() });

    renderBoard();
    save();
  }

  function renderBoard(){
    $("boardArea").style.display = state.showBoard ? "block" : "none";
    $("countPredict").textContent = state.boardPredict.length + " items";
    $("countActual").textContent = state.boardActual.length + " items";

    $("predictList").innerHTML = state.boardPredict.map(itemToLi).join("");
    $("actualList").innerHTML = state.boardActual.map(itemToLi).join("");
  }

  function itemToLi(it){
    const showTag = state.showCategories;
    const cls = tagClass(it.type);
    const tag = showTag ? `<div class="tag ${cls}">${escapeHtml(it.category)}</div>` : "";
    return `<li>${escapeHtml(it.text)}${tag}</li>`;
  }

  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function exportText(){
    const s = findScenario(state.scenarioId);
    const lines = [];
    lines.push("üß† YOUR BRAIN IS A PREDICTION MACHINE ‚Äî Scenario Choices");
    lines.push("");
    lines.push("Current scenario:");
    lines.push(`- ${s.category}: ${s.title}`);
    lines.push(`- ${s.text}`);
    lines.push("");

    if(state.selectedChoiceIndex !== null){
      const c = s.choices[state.selectedChoiceIndex];
      const v = verdictFor(c.type);
      lines.push("Selected choice + feedback:");
      lines.push(`- Choice: ${c.label}`);
      lines.push(`- Verdict: ${v.title}`);
      lines.push(`- Why the brain wants it: ${c.whyBrain}`);
      lines.push(`- Short-term: ${c.shortTerm}`);
      lines.push(`- Long-term: ${c.longTerm}`);
      lines.push(`- Actually helps: ${c.actuallyHelps}`);
      lines.push("");
    }

    lines.push("Board ‚Äî Brain predicts:");
    if(state.boardPredict.length === 0) lines.push("  (none)");
    state.boardPredict.slice().reverse().forEach(it => lines.push(`  - [${it.category}] ${it.text}`));
    lines.push("");

    lines.push("Board ‚Äî Actually helps:");
    if(state.boardActual.length === 0) lines.push("  (none)");
    state.boardActual.slice().reverse().forEach(it => lines.push(`  - [${it.category}] ${it.text}`));
    lines.push("");

    lines.push("Tip: Look for the dominant pattern. Fast relief trains loops; approach + regulation + values breaks loops.");

    const out = lines.join("\n");
    $("exportPreview").value = out;

    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(out).catch(()=>{});
    }
  }

  function clearBoard(){
    if(!confirm("Clear the board lists?")) return;
    state.boardPredict = [];
    state.boardActual = [];
    $("exportPreview").value = "";
    renderBoard();
    save();
  }

  function clearFeedback(){
    state.selectedChoiceIndex = null;
    renderFeedback();
    save();
  }

  function pickRandom(){
    const idx = Math.floor(Math.random() * scenarios.length);
    state.scenarioId = scenarios[idx].id;
    state.selectedChoiceIndex = null;
    $("scenarioSelect").value = state.scenarioId;
    renderScenario();
  }

  // ===== Events =====
  $("scenarioSelect").addEventListener("change", (e) => {
    state.scenarioId = e.target.value;
    state.selectedChoiceIndex = null;
    renderScenario();
  });

  $("randomBtn").addEventListener("click", pickRandom);
  $("resetChoiceBtn").addEventListener("click", clearFeedback);
  $("tryAnotherBtn").addEventListener("click", clearFeedback);
  $("addToBoardBtn").addEventListener("click", addToBoard);

  $("exportBtn").addEventListener("click", exportText);
  $("clearBoardBtn").addEventListener("click", clearBoard);

  $("showCategories").addEventListener("change", (e) => {
    state.showCategories = e.target.checked;
    renderBoard();
    save();
  });
  $("showBoard").addEventListener("change", (e) => {
    state.showBoard = e.target.checked;
    renderBoard();
    save();
  });

  // ===== Init =====
  load();
  if(!state.scenarioId) state.scenarioId = scenarios[0]?.id || null;
  renderScenarioSelect();
  renderScenario();
})();
</script>
</body>
</html>
